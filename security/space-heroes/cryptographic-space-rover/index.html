<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
        <meta content="text/html; charset=UTF-8" http-equiv="content-type"/>
        <meta content="width=device-width, initial-scale=1" name="viewport"/>

        
        
        

        

        

        

        
        
        

        <title>Space Rover</title>
        
        <meta name="title" content="Space Rover">
        
        
        <meta name="generator" content="Zola v0.16.1">

        <meta property="og:type" content="website">
        <meta property="og:url" content="https://vaughn.sh/security/space-heroes/cryptographic-space-rover/">
        <meta property="og:site_name" content="">
        <meta property="og:title" content="Space Rover">
        
        

        
        
        <meta property="twitter:card" content="summary_large_image">
        <meta property="twitter:url" content="https://vaughn.sh/security/space-heroes/cryptographic-space-rover/">
        <meta property="twitter:title" content="Space Rover">
        
        
        
        
        <link rel="canonical" href="https://vaughn.sh/security/space-heroes/cryptographic-space-rover/">
        
        <script type="application/ld+json">
            {
                
                "url":"https://vaughn.sh/security/space-heroes/cryptographic-space-rover/",
                "@type":"WebSite",
                "headline":"Space Rover",
                "name":"Space Rover",
                
                "@context":"https://schema.org"
            }
        </script>
        
        
        
        <link rel="stylesheet" href="https://vaughn.sh/style.css"/>
        
    </head>
    <body theme="auto">
        <div class="w">
            <header>
                
                <nav>
                    
                    <a href="/" >@home</a>
                    
                    <a href="/recipes" >#recipes</a>
                    
                    <a href="/security" >+security</a>
                    
                    <a href="/hobbies" >$hobbies</a>
                    
                    <a href="https://github.com/vaughnw128" >~github</a>
                    
                    <a href="https://sbcord.com" >!friends</a>
                    
                </nav>
                
                
<p><a href="..">..</a>/cryptographic-space-rover</p>
<p class="post-meta"><time datetime=""></time></p>
<h1>Space Rover</h1>

            </header>
            <main class="page-content" aria-label="Content">
                



<p><strong>Category:</strong> Crypto</p>
<p><strong>Points:</strong> ???</p>
<p><strong>Solved By:</strong> Apicius</p>
<h2 id="challenge">Challenge</h2>
<blockquote>
<p>NASA has sent this custom program off to a remote space rover, luckily it already had Python and all the dependencies installed so we don't have to worry about transferring those. It will print the CPU usage and some fun other facts about the system when it's run. It seems to run an equal number of time to the number of characters entered. For some reason, certain characters at certain indexes cause new processes to spawn... can you help us find what characters to avoid at certain indexes?</p>
<p><em>Author: teeman22</em></p>
</blockquote>
<p>Files: <code>nasa_crypto.py</code></p>
<h2 id="solution">Solution</h2>
<p>This was for sure my favorite challenge of the competition, as I got to do some cool scripting.</p>
<p>Reading <code>nasa_crypto.py</code> reveals how we have to solve the challenge: brute force guessing.</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">main</span><span>():
</span><span>    session_uuid = uuid.</span><span style="color:#bf616a;">uuid4</span><span>()
</span><span>    flag = </span><span style="color:#96b5b4;">open</span><span>(&#39;</span><span style="color:#a3be8c;">flag.txt</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">r</span><span>&#39;).</span><span style="color:#bf616a;">readline</span><span>().</span><span style="color:#bf616a;">strip</span><span>(&#39;</span><span style="color:#96b5b4;">\n</span><span>&#39;).</span><span style="color:#bf616a;">lower</span><span>()
</span><span>    </span><span style="color:#bf616a;">logo</span><span>(session_uuid)
</span><span>
</span><span>    </span><span style="color:#96b5b4;">print</span><span>(&quot;</span><span style="color:#a3be8c;">Please enter characters:: </span><span>&quot;)
</span><span>    user_guess = </span><span style="color:#96b5b4;">input</span><span>().</span><span style="color:#bf616a;">lower</span><span>().</span><span style="color:#bf616a;">strip</span><span>(&quot;</span><span style="color:#96b5b4;">\n</span><span>&quot;)
</span><span>
</span><span>    </span><span style="color:#b48ead;">for </span><span>i </span><span style="color:#b48ead;">in </span><span style="color:#96b5b4;">range</span><span>(</span><span style="color:#d08770;">0</span><span>, </span><span style="color:#96b5b4;">len</span><span>(flag)):
</span><span>        </span><span style="color:#b48ead;">if </span><span>i+</span><span style="color:#d08770;">1 </span><span>&gt; </span><span style="color:#96b5b4;">len</span><span>(user_guess):
</span><span>            </span><span style="color:#bf616a;">print_top</span><span>(</span><span style="color:#bf616a;">guess</span><span>=</span><span style="color:#d08770;">None</span><span>, </span><span style="color:#bf616a;">uuid</span><span>=session_uuid)
</span><span>            </span><span style="color:#bf616a;">exit</span><span>(-</span><span style="color:#d08770;">1</span><span>)
</span><span>        </span><span style="color:#b48ead;">elif </span><span>(user_guess[i] != flag[i]):
</span><span>            </span><span style="color:#bf616a;">print_top</span><span>(</span><span style="color:#bf616a;">guess</span><span>=</span><span style="color:#d08770;">False</span><span>, </span><span style="color:#bf616a;">uuid</span><span>=session_uuid)
</span><span>        </span><span style="color:#b48ead;">else</span><span>:
</span><span>            </span><span style="color:#bf616a;">print_top</span><span>(</span><span style="color:#bf616a;">guess</span><span>=</span><span style="color:#d08770;">True</span><span>,</span><span style="color:#bf616a;">uuid</span><span>=session_uuid)
</span><span>
</span><span>    </span><span style="color:#b48ead;">if </span><span>user_guess == flag:
</span><span>        </span><span style="color:#96b5b4;">print</span><span>(</span><span style="color:#b48ead;">f</span><span>&quot;</span><span style="color:#a3be8c;">Thanks; we&#39;ll avoid these characters: </span><span>{flag}&quot;)
</span><span>
</span><span style="color:#b48ead;">if </span><span>__name__ == &quot;</span><span style="color:#a3be8c;">__main__</span><span>&quot;:
</span><span>    </span><span style="color:#bf616a;">main</span><span>()
</span></code></pre>
<p>The main function prompts the user for a guess of the flag. It then loops along the flag and checks whether the guessed character at that location is the same as the flags. If it isnt, it passes guess=False. If it is, it passes guess=True. If the user guess is too short, it passes nothing and then exits the program.</p>
<p>Checking the print_top function we can see our returned indicator for if the guess is correct:</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get_dashes</span><span>(</span><span style="color:#bf616a;">perc</span><span>):
</span><span>    dashes = &quot;</span><span style="color:#a3be8c;">|</span><span>&quot; * </span><span style="color:#bf616a;">int</span><span>((</span><span style="color:#bf616a;">float</span><span>(perc) / </span><span style="color:#d08770;">10 </span><span>* </span><span style="color:#d08770;">4</span><span>))
</span><span>    empty_dashes = &quot; &quot; * (</span><span style="color:#d08770;">40 </span><span>- </span><span style="color:#96b5b4;">len</span><span>(dashes))
</span><span>    </span><span style="color:#b48ead;">return </span><span>dashes, empty_dashes
</span><span>
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">print_top</span><span>(</span><span style="color:#bf616a;">guess</span><span>, </span><span style="color:#bf616a;">uuid</span><span>):
</span><span>    cat_check = </span><span style="color:#d08770;">0
</span><span>    </span><span style="color:#b48ead;">if</span><span>(guess == </span><span style="color:#d08770;">True</span><span>):
</span><span>        setproctitle.</span><span style="color:#bf616a;">setproctitle</span><span>(</span><span style="color:#bf616a;">str</span><span>(uuid))
</span><span>        setproctitle.</span><span style="color:#bf616a;">setthreadtitle</span><span>(</span><span style="color:#bf616a;">str</span><span>(uuid))
</span><span>
</span><span>    </span><span style="color:#96b5b4;">print</span><span>(</span><span style="color:#b48ead;">f</span><span>&quot;</span><span style="color:#a3be8c;">top - </span><span>{</span><span style="color:#bf616a;">str</span><span>(datetime.</span><span style="color:#bf616a;">timedelta</span><span>(</span><span style="color:#bf616a;">seconds</span><span>=psutil.</span><span style="color:#bf616a;">boot_time</span><span>()))}&quot;)
</span><span>    percs = psutil.</span><span style="color:#bf616a;">cpu_percent</span><span>(</span><span style="color:#bf616a;">interval</span><span>=</span><span style="color:#d08770;">0</span><span>, </span><span style="color:#bf616a;">percpu</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>    </span><span style="color:#b48ead;">for </span><span>cpu_num, perc </span><span style="color:#b48ead;">in </span><span style="color:#96b5b4;">enumerate</span><span>(percs):
</span><span>        dashes, empty_dashes = </span><span style="color:#bf616a;">get_dashes</span><span>(perc)
</span><span>        line = &quot;</span><span style="color:#a3be8c;"> CPU</span><span style="color:#d08770;">%-2s</span><span style="color:#a3be8c;"> [</span><span style="color:#d08770;">%s%s</span><span style="color:#a3be8c;">] </span><span style="color:#d08770;">%5s%%</span><span>&quot; % (cpu_num, dashes, empty_dashes, perc)
</span><span>        </span><span style="color:#96b5b4;">print</span><span>(line)
</span><span>
</span><span>    virtual_memory = psutil.</span><span style="color:#bf616a;">virtual_memory</span><span>()
</span><span>    </span><span style="color:#96b5b4;">print</span><span>(</span><span style="color:#b48ead;">f</span><span>&quot;</span><span style="color:#a3be8c;">MiB Swap :</span><span style="color:#96b5b4;">\t</span><span>{virtual_memory.total / </span><span style="color:#d08770;">1024 </span><span>/ </span><span style="color:#d08770;">1024:.2f</span><span>}</span><span style="color:#a3be8c;"> total</span><span style="color:#96b5b4;">\t</span><span>{virtual_memory.free / </span><span style="color:#d08770;">1024 </span><span>/ </span><span style="color:#d08770;">1024:.2f</span><span>}</span><span style="color:#a3be8c;"> free</span><span style="color:#96b5b4;">\t</span><span>{virtual_memory.used / </span><span style="color:#d08770;">1024 </span><span>/ </span><span style="color:#d08770;">1024:.2f</span><span>}</span><span style="color:#a3be8c;"> used</span><span style="color:#96b5b4;">\t</span><span>{virtual_memory.active / </span><span style="color:#d08770;">1024 </span><span>/ </span><span style="color:#d08770;">1024:.2f</span><span>}</span><span style="color:#a3be8c;"> active</span><span>&quot;)
</span><span>    swap_memory = psutil.</span><span style="color:#bf616a;">swap_memory</span><span>()
</span><span>    </span><span style="color:#96b5b4;">print</span><span>(</span><span style="color:#b48ead;">f</span><span>&quot;</span><span style="color:#a3be8c;">MiB Swap :</span><span style="color:#96b5b4;">\t</span><span>{swap_memory.total / </span><span style="color:#d08770;">1024 </span><span>/ </span><span style="color:#d08770;">1024:.2f</span><span>}</span><span style="color:#a3be8c;"> total</span><span style="color:#96b5b4;">\t</span><span>{swap_memory.free / </span><span style="color:#d08770;">1024 </span><span>/ </span><span style="color:#d08770;">1024:.2f</span><span>}</span><span style="color:#a3be8c;"> free</span><span style="color:#96b5b4;">\t</span><span>{swap_memory.used / </span><span style="color:#d08770;">1024 </span><span>/ </span><span style="color:#d08770;">1024:.2f</span><span>}</span><span style="color:#a3be8c;"> used</span><span>&quot;)
</span><span>
</span><span>    listOfProcessNames = []
</span><span>    </span><span style="color:#b48ead;">for </span><span>proc </span><span style="color:#b48ead;">in </span><span>psutil.</span><span style="color:#bf616a;">process_iter</span><span>():
</span><span>        pInfoDict = proc.</span><span style="color:#bf616a;">as_dict</span><span>(</span><span style="color:#bf616a;">attrs</span><span>=[&#39;</span><span style="color:#a3be8c;">pid</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">username</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">cpu_percent</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">memory_percent</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">status</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">name</span><span>&#39;]) </span><span style="color:#65737e;"># Get process detail as dictionary
</span><span>        listOfProcessNames.</span><span style="color:#bf616a;">append</span><span>(pInfoDict) </span><span style="color:#65737e;"># Add to list
</span><span>
</span><span>    </span><span style="color:#96b5b4;">print</span><span>(</span><span style="color:#b48ead;">f</span><span>&#39;{&quot;</span><span style="color:#a3be8c;">PID</span><span>&quot;</span><span style="color:#d08770;">:&gt;6</span><span>}{&quot;</span><span style="color:#a3be8c;">USER</span><span>&quot;</span><span style="color:#d08770;">:&gt;10</span><span>}{&quot;</span><span style="color:#a3be8c;">%CPU</span><span>&quot;</span><span style="color:#d08770;">:&gt;6</span><span>}{&quot;</span><span style="color:#d08770;">%M</span><span style="color:#a3be8c;">EM</span><span>&quot;</span><span style="color:#d08770;">:&gt;6</span><span>}{&quot;</span><span style="color:#a3be8c;">STATUS</span><span>&quot;</span><span style="color:#d08770;">:&gt;15</span><span>}{&quot;</span><span style="color:#a3be8c;">NAME</span><span>&quot;</span><span style="color:#d08770;">:&gt;45</span><span>}&#39;)
</span><span>    </span><span style="color:#b48ead;">for </span><span>elem </span><span style="color:#b48ead;">in </span><span>listOfProcessNames:
</span><span>        </span><span style="color:#96b5b4;">print</span><span>(</span><span style="color:#b48ead;">f</span><span>&#39;{elem[&quot;</span><span style="color:#a3be8c;">pid</span><span>&quot;]</span><span style="color:#d08770;">:&gt;6</span><span>}{elem[&quot;</span><span style="color:#a3be8c;">username</span><span>&quot;]</span><span style="color:#d08770;">:&gt;10</span><span>}{elem[&quot;</span><span style="color:#a3be8c;">cpu_percent</span><span>&quot;]</span><span style="color:#d08770;">:&gt;6</span><span>}{elem[&quot;</span><span style="color:#a3be8c;">memory_percent</span><span>&quot;]</span><span style="color:#d08770;">:&gt;6.2f</span><span>}{elem[&quot;</span><span style="color:#a3be8c;">status</span><span>&quot;]</span><span style="color:#d08770;">:&gt;15</span><span>}{elem[&quot;</span><span style="color:#a3be8c;">name</span><span>&quot;]</span><span style="color:#d08770;">:&gt;45</span><span>}&#39;)
</span><span>
</span><span>    </span><span style="color:#b48ead;">if </span><span>(guess == </span><span style="color:#d08770;">True</span><span>):
</span><span>        setproctitle.</span><span style="color:#bf616a;">setproctitle</span><span>(&quot;</span><span style="color:#a3be8c;">python3</span><span>&quot;)
</span><span>        setproctitle.</span><span style="color:#bf616a;">setthreadtitle</span><span>(&quot;</span><span style="color:#a3be8c;">python3</span><span>&quot;)
</span></code></pre>
<p>When guess is true, it sets the proc title to be the uuid that was set in the main function. Knowing this, we can check the output and count how many uuids to see how many characters we got correct. I wrote a script to do this, and then send the guess to the remote server.</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>pwn </span><span style="color:#b48ead;">import </span><span style="color:#d08770;">* 
</span><span>context.log_level = &#39;</span><span style="color:#a3be8c;">error</span><span>&#39;
</span><span>
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">send_guess</span><span>(</span><span style="color:#bf616a;">flag</span><span>):
</span><span>    r = </span><span style="color:#bf616a;">remote</span><span>(&quot;</span><span style="color:#a3be8c;">spaceheroes-cryptographic-space-rover.chals.io</span><span>&quot;, </span><span style="color:#d08770;">443</span><span>, </span><span style="color:#bf616a;">ssl</span><span>=</span><span style="color:#d08770;">True</span><span>, </span><span style="color:#bf616a;">sni</span><span>=&quot;</span><span style="color:#a3be8c;">spaceheroes-cryptographic-space-rover.chals.io</span><span>&quot;)
</span><span>    </span><span style="color:#b48ead;">for </span><span>i </span><span style="color:#b48ead;">in </span><span style="color:#96b5b4;">range</span><span>(</span><span style="color:#d08770;">0</span><span>,</span><span style="color:#d08770;">26</span><span>):
</span><span>        </span><span style="color:#b48ead;">if </span><span>i == </span><span style="color:#d08770;">8</span><span>:
</span><span>            uuid = (r.</span><span style="color:#bf616a;">recvline</span><span>()).</span><span style="color:#bf616a;">decode</span><span>().</span><span style="color:#bf616a;">strip</span><span>().</span><span style="color:#bf616a;">replace</span><span>(&quot; &quot;, &quot;&quot;).</span><span style="color:#bf616a;">replace</span><span>(&quot;</span><span style="color:#a3be8c;">|</span><span>&quot;,&quot;&quot;)
</span><span>        </span><span style="color:#b48ead;">else</span><span>:
</span><span>            r.</span><span style="color:#bf616a;">recvline</span><span>()
</span><span>
</span><span>    r.</span><span style="color:#bf616a;">sendline</span><span>(flag.</span><span style="color:#bf616a;">encode</span><span>())
</span><span>    
</span><span>    count = </span><span style="color:#d08770;">0
</span><span>    </span><span style="color:#b48ead;">while </span><span style="color:#d08770;">True</span><span>:
</span><span>        </span><span style="color:#b48ead;">try</span><span>:
</span><span>            line = r.</span><span style="color:#bf616a;">recvline</span><span>().</span><span style="color:#bf616a;">decode</span><span>()
</span><span>            </span><span style="color:#b48ead;">if </span><span>uuid in line:
</span><span>                count+=</span><span style="color:#d08770;">1
</span><span>        </span><span style="color:#b48ead;">except</span><span>:
</span><span>            </span><span style="color:#b48ead;">break
</span><span>    </span><span style="color:#96b5b4;">print</span><span>(</span><span style="color:#b48ead;">f</span><span>&quot;{count}</span><span style="color:#a3be8c;"> - </span><span>{flag}&quot;)
</span><span>    </span><span style="color:#b48ead;">if </span><span>count &gt;= </span><span style="color:#96b5b4;">len</span><span>(flag):
</span><span>        </span><span style="color:#b48ead;">return </span><span>flag
</span><span>    r.</span><span style="color:#bf616a;">close</span><span>()
</span><span>    </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">None    
</span><span>
</span><span>initflag = &quot;</span><span style="color:#a3be8c;">shCTF{</span><span>&quot;
</span><span>asciiString = &#39;</span><span style="color:#a3be8c;"> !&quot;#$%&amp;</span><span style="color:#96b5b4;">\&#39;</span><span style="color:#a3be8c;">()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[</span><span style="color:#96b5b4;">\\</span><span style="color:#a3be8c;">]^_`abcdefghijklmnopqrstuvwxyz{|}~</span><span>&#39;
</span><span>
</span><span style="color:#b48ead;">while </span><span style="color:#d08770;">True</span><span>:
</span><span>    </span><span style="color:#b48ead;">for </span><span>char </span><span style="color:#b48ead;">in </span><span>asciiString:
</span><span>        flag = initflag+char
</span><span>        flag = </span><span style="color:#bf616a;">send_guess</span><span>(flag)
</span><span>        </span><span style="color:#b48ead;">if </span><span>flag is not </span><span style="color:#d08770;">None</span><span>:
</span><span>            initflag = flag
</span><span>            </span><span style="color:#b48ead;">continue
</span></code></pre>
<p>This script loops through all ascii characters, and then uses those to progressively guess the flag. It checks to see if the current guess is right by checking the number of uuids printed out. To make it easier, I silenced all output from the actual program and just let it guess.</p>
<p><img src="https://vaughn.sh/security/space-heroes/cryptographic-space-rover/brute_force_nasa.png" alt="" /></p>
<p><strong>Flag:</strong> <code>shCTF{MET30RS_4R3NT_aS_b4D_4S_sL0W_cpu}</code></p>


            </main>
            <footer>
                
<p class="taxonomies">

</p>

                
            </footer>
        </div>
    </body>
</html>
        
